<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Tabel Kebenaran Logika</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="calculator">
        <h1>Kalkulator Logika</h1>

        <form method="POST" class="grid" id="calcForm" autocomplete="off" style="grid-template-columns: 1fr;">
            <!-- DISPLAY SBG TEXTAREA -->
            <textarea id="display" name="expr" class="display-box"
                placeholder="Masukkan ekspresi logika, satu per baris...&#10;(Contoh: (Pâˆ§~Q)â†’P)"
                required>{{ expr }}</textarea>

            <!-- Tombol Operator (Flex Responsive) -->
            <div class="grid" style="margin-top:15px;grid-template-columns: repeat(4,1fr);">
                <button type="button" onclick="add('~')" class="btn grey"
                    title="Negasi / NOT">~<span>NOT</span></button>
                <button type="button" onclick="add('âˆ§')" class="btn grey"
                    title="Konjungsi / AND">âˆ§<span>AND</span></button>
                <button type="button" onclick="add('âˆ¨')" class="btn grey"
                    title="Disjungsi / OR">âˆ¨<span>OR</span></button>
                <button type="button" onclick="add('âŠ•')" class="btn grey" title="XOR">âŠ•<span>XOR</span></button>
                <button type="button" onclick="add('â†’')" class="btn blue"
                    title="Implikasi">â†’<span>Implikasi</span></button>
                <button type="button" onclick="add('â†”')" class="btn blue"
                    title="Bi-implikasi">â†”<span>Bi-implikasi</span></button>
                <button type="button" onclick="add('â†‘')" class="btn purple" title="NAND">â†‘<span>NAND</span></button>
                <button type="button" onclick="add('â†“')" class="btn purple" title="NOR">â†“<span>NOR</span></button>
                <button type="button" onclick="add('(')" class="btn grey"
                    title="Kurung Buka">(<span>Buka</span></button>
                <button type="button" onclick="add(')')" class="btn grey"
                    title="Kurung Tutup">)<span>Tutup</span></button>
                <button type="button" onclick="addNewLine()" class="btn grey"
                    title="Baris Baru untuk ekspresi berikutnya">&#9166;<span>Baru</span></button>
                <button type="button" onclick="backspace()" class="btn darkred"
                    title="Hapus 1 karakter">âŒ«<span>Del</span></button>
                <button type="button" onclick="add('P')" class="btn red" title="Variabel P">P<span>Var</span></button>
                <button type="button" onclick="add('Q')" class="btn red" title="Variabel Q">Q<span>Var</span></button>
                <button type="button" onclick="add('R')" class="btn red" title="Variabel R">R<span>Var</span></button>
                <button type="button" onclick="add('S')" class="btn red" title="Variabel S">S<span>Var</span></button>
                <button type="button" onclick="clearDisplay()" class="btn darkred"
                    title="Clear semua">AC<span>Clear</span></button>
                <button type="submit" class="btn blue equal" style="grid-column: span 3;"
                    title="Tampilkan Tabel">=<span>Hitung</span></button>
            </div>
        </form>

        <!-- Panduan Penggunaan -->
        <div class="help-box">
            <details>
                <summary>ðŸ“– Panduan Penggunaan</summary>
                <ul>
                    <li><strong>Operator:</strong> ~ (NOT), âˆ§ (AND), âˆ¨ (OR), âŠ• (XOR), â†’ (Implikasi), â†” (Bi-implikasi), â†‘
                        (NAND), â†“ (NOR)</li>
                    <li><strong>Variabel:</strong> Huruf kapital A-Z (P, Q, R, S, ...)</li>
                    <li><strong>Multi-ekspresi:</strong> 1 ekspresi tiap baris! (Contoh: <code>Pâˆ§Q&#10;Pâˆ¨Q</code>)</li>
                    <li><strong>Gunakan Kurung</strong> ( ) untuk prioritas</li>
                </ul>
                <p><strong>Contoh:</strong></p>
                <code>Pâ†’Q<br>(Pâˆ§~Q)â†’P<br>Pâ†‘Q<br>Pâ†“Q</code>
            </details>
        </div>

        <!-- Tabel Kebenaran -->
        {% if expressions %}
        <div class="table-wrap">
            <h3>Tabel Kebenaran</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            {% for v in vars %}
                            <th class="var-col">{{ v }}</th>
                            {% endfor %}
                            {% for expr in expressions %}
                            <th class="expr-col">{{ expr|replace('~','Â¬') }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in table %}
                        <tr>
                            {% for v in vars %}
                            <td class="{{ 'benar' if row[v]=='B' else 'salah' }}">{{ row[v] }}</td>
                            {% endfor %}
                            {% for expr in expressions %}
                            <td class="{{ 'benar' if row[expr]=='B' else 'salah' }}">{{ row[expr] }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="table-info">
                <strong>B</strong> = Benar/True, <strong>S</strong> = Salah/False.<br>
                Setiap ekspresi di baris berbeda akan dibuat kolom sendiri di tabel.
            </div>
        </div>
        {% endif %}
    </div>

    <script>
        // Ambil elemen display textarea
        const display = document.getElementById("display");

        function add(x) {
            // Posisi kursor & insert
            let start = display.selectionStart;
            let end = display.selectionEnd;
            let before = display.value.substring(0, start);
            let after = display.value.substring(end, display.value.length);
            display.value = before + x + after;
            display.selectionStart = display.selectionEnd = start + x.length;
            display.focus();
        }

        function addNewLine() {
            let start = display.selectionStart;
            let end = display.selectionEnd;
            let before = display.value.substring(0, start);
            let after = display.value.substring(end, display.value.length);
            display.value = before + '\n' + after;
            display.selectionStart = display.selectionEnd = start + 1;
            display.focus();
        }

        function backspace() {
            let start = display.selectionStart;
            let end = display.selectionEnd;
            if (start === end && start > 0) {
                display.value = display.value.slice(0, start - 1) + display.value.slice(end);
                display.selectionStart = display.selectionEnd = start - 1;
            } else if (start !== end) {
                display.value = display.value.slice(0, start) + display.value.slice(end);
                display.selectionStart = display.selectionEnd = start;
            }
            display.focus();
        }

        function clearDisplay() {
            display.value = "";
            display.focus();
        }

        // Keyboard support: enter==submit, esc==clear
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                document.getElementById('calcForm').submit();
            }
            if (e.key === 'Escape') {
                clearDisplay();
            }
        });

        // Auto-focus ke display saat load
        window.addEventListener('load', function () {
            display.focus();
        });
    </script>
</body>

</html>
